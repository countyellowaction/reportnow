(window.webpackJsonp=window.webpackJsonp||[]).push([[3],{252:function(t,e,r){var content=r(279);"string"==typeof content&&(content=[[t.i,content,""]]),content.locals&&(t.exports=content.locals);(0,r(28).default)("c8ed1a44",content,!0,{sourceMap:!1})},253:function(t,e,r){var content=r(281);"string"==typeof content&&(content=[[t.i,content,""]]),content.locals&&(t.exports=content.locals);(0,r(28).default)("8bea0fa2",content,!0,{sourceMap:!1})},278:function(t,e,r){"use strict";var o=r(252);r.n(o).a},279:function(t,e,r){(t.exports=r(27)(!1)).push([t.i,"",""])},280:function(t,e,r){"use strict";var o=r(253);r.n(o).a},281:function(t,e,r){(t.exports=r(27)(!1)).push([t.i,"",""])},290:function(t,e,r){"use strict";r.r(e);r(42),r(20),r(16),r(11),r(33);var o=r(19),n=r(31),c=r(287);function l(object,t){var e=Object.keys(object);if(Object.getOwnPropertySymbols){var r=Object.getOwnPropertySymbols(object);t&&(r=r.filter(function(t){return Object.getOwnPropertyDescriptor(object,t).enumerable})),e.push.apply(e,r)}return e}var f={components:{},props:{center:{type:Object,required:!1,default:null},markerList:{type:Array,required:!1,default:null}},data:function(){return{map:null,geoLocationMarker:null,markerSource:null,markerLayer:null}},computed:function(t){for(var i=1;i<arguments.length;i++){var source=null!=arguments[i]?arguments[i]:{};i%2?l(source,!0).forEach(function(e){Object(o.a)(t,e,source[e])}):Object.getOwnPropertyDescriptors?Object.defineProperties(t,Object.getOwnPropertyDescriptors(source)):l(source).forEach(function(e){Object.defineProperty(t,e,Object.getOwnPropertyDescriptor(source,e))})}return t}({},Object(n.b)("app",{geoLocation:"geoLocation"})),created:function(){window&&!window.ol&&(window.OL={ol:r(284),TileLayer:r(288).default,OSM:r(285).default,proj:r(203),condition:r(207),style:r(286),Point:r(242).default,SourceVector:r(268).default,LayerVector:r(267).default,Select:r(251).default})},watch:{center:function(){this.updateCenter(this.center)},geoLocation:function(t){if(t&&!this.geoLocationMarker){var e=OL,ol=e.ol,r=e.Point,o=e.proj,n=new ol.Feature({geometry:new r(o.fromLonLat([_.get(t,"coords.longitude",0),_.get(t,"coords.latitude",0)]))});this.$set(this,"geoLocationMarker",n),this.updateMarker()}},markerList:function(){this.updateMarker()}},mounted:function(){var t=this,e=OL,ol=e.ol,r=e.OSM,o=e.proj,n=e.TileLayer,c=e.SourceVector,l=e.LayerVector,f=e.Select,d=e.condition,map=new ol.Map({target:"map",layers:[new n({source:new r})],view:new ol.View({center:o.fromLonLat(this.center?[this.center.long,this.center.lat]:[114.0719,22.4253]),zoom:17})}),h=new c({features:[]}),m=new l({source:h});map.addLayer(m);var select=new f({condition:d.click});map.addInteraction(select),select.on("select",function(e){var r=e.target.getFeatures().item(0);if(r){var data=r.getProperties().data;t.$emit("clickMarker",data)}}),map.on("moveend",function(e){t.emitRect()}),this.$set(this,"map",map),this.$set(this,"markerSource",h),this.$set(this,"markerLayer",m),window.map=map,this.updateMarker()},methods:{updateCenter:function(t){var e=this,r=t.lat,o=t.long,n=t.zoomD,c=OL.proj,map=this.map;if(map){var view=map.getView();view&&(view.animate({center:c.fromLonLat([o,r]),duration:1e3,zoom:view.getZoom()>=19?view.getZoom()+(n||0):19}),_.delay(function(){e.emitRect()},1e3))}},emitRect:function(){var t=OL.proj,map=this.map;if(map){var view=map.getView(),e=t.transformExtent(view.calculateExtent(map.getSize()),"EPSG:900913","EPSG:4326"),r=[{long:e[0],lat:e[1]},{long:e[2],lat:e[3]}];this.$emit("updateRect",r)}},updateMarker:function(){var t=OL,ol=t.ol,e=t.Point,r=t.proj,style=t.style,source=this.markerSource;if(source){var o=_.round(this.map.getView().getZoom());if(o<15)source.clear();else{var n=_.max([_.min([-(13-o),12]),3]),l=_.reduce(_.groupBy(this.markerList,"data.roundKey.".concat(n)),function(t,e,r){return t.push({lat:_.get(e,"[0].lat",0),long:_.get(e,"[0].long",0),data:_.map(e,"data")}),t},[]),f=[].concat(Object(c.a)([this.geoLocationMarker]||!1),Object(c.a)(_.map(l,function(t){var o=t.lat,n=t.long,data=t.data,c=new ol.Feature({geometry:new e(r.fromLonLat([n,o])),data:data}),l=_.size(data),f=.2;return l>1?f=.25:l>4?f=.3:l>8?f=.35:l>10&&(f=.4),c.setStyle(new style.Style({image:new style.Icon({anchor:[.5,1],anchorXUnits:"fraction",anchorYUnits:"fraction",src:"pin.png",scale:f})})),c})));source.clear(),source.addFeatures(_.filter(f,_.identity))}}}}},d=(r(278),r(15));function h(object,t){var e=Object.keys(object);if(Object.getOwnPropertySymbols){var r=Object.getOwnPropertySymbols(object);t&&(r=r.filter(function(t){return Object.getOwnPropertyDescriptor(object,t).enumerable})),e.push.apply(e,r)}return e}var m={components:{mapView:Object(d.a)(f,function(){var t=this.$createElement;this._self._c;return this._m(0)},[function(){var t=this.$createElement,e=this._self._c||t;return e("div",{staticClass:"map w-full h-full"},[e("div",{staticClass:"w-full h-full",attrs:{id:"map"}})])}],!1,null,"559d9c02",null).exports},data:function(){return{local:{mapCenter:null}}},computed:function(t){for(var i=1;i<arguments.length;i++){var source=null!=arguments[i]?arguments[i]:{};i%2?h(source,!0).forEach(function(e){Object(o.a)(t,e,source[e])}):Object.getOwnPropertyDescriptors?Object.defineProperties(t,Object.getOwnPropertyDescriptors(source)):h(source).forEach(function(e){Object.defineProperty(t,e,Object.getOwnPropertyDescriptor(source,e))})}return t}({},Object(n.b)("app",{geoLocation:"geoLocation"}),{},Object(n.b)("shop",{hasFilter:"hasFilter",filteredList:"filteredList"}),{markerList:function(){return this.hasFilter?_.map(this.filteredList,function(data){return{lat:data.latitude,long:data.longitude,data:data}}):null}}),watch:{geoLocation:function(t,e){e||this.moveToCurrentLocation()}},mounted:function(){this.$store.dispatch("app/init"),this.geoLocation&&this.moveToCurrentLocation()},methods:{moveToCurrentLocation:function(){this.$set(this.local,"mapCenter",{lat:_.get(this.geoLocation,"coords.latitude",0),long:_.get(this.geoLocation,"coords.longitude",0)})},onUpdateRect:function(t){this.$store.dispatch("shop/applyFilter",{rect:t})},onClickMarker:function(data){var t=_.uniq(_.map(data,"latitude")),e=_.uniq(_.map(data,"longitude")),r=_.size(data);this.$set(this.local,"mapCenter",{lat:_.get(data,"[0].latitude",0),long:_.get(data,"[0].longitude",0),zoomD:r>1&&(_.size(t)>1||_.size(e)>1)?1:0})}}},w=(r(280),Object(d.a)(m,function(){var t=this.$createElement,e=this._self._c||t;return e("div",{staticClass:"map-page w-full h-full"},[e("no-ssr",[e("map-view",{ref:"map",attrs:{center:this.local.mapCenter,markerList:this.markerList},on:{updateRect:this.onUpdateRect,clickMarker:this.onClickMarker}})],1)],1)},[],!1,null,"297608aa",null));e.default=w.exports}}]);